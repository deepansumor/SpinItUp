!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.SpinItUp=e():t.SpinItUp=e()}("undefined"!=typeof self?self:this,(()=>(()=>{"use strict";var t={d:(e,s)=>{for(var i in s)t.o(s,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:s[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)},e={};t.d(e,{default:()=>o});class s{static create(t){o.log("Creating slices with segments:",t);const e=t.length;let i=0;const n=[];return t.forEach(((t,o)=>{const a=1/e*2*Math.PI;n.push(new s(i,i+a,o,t)),i+=a})),n}static getClickedSliceIndex(t,e,s,i){o.log("Determining clicked slice based on event:",t);const n=e.getBoundingClientRect(),a=t.clientX-n.left-s/2,l=t.clientY-n.top-s/2;if(Math.sqrt(a*a+l*l)>s/2)return o.log("Click outside the wheel."),null;const h=Math.atan2(l,a),c=h<0?h+2*Math.PI:h;for(const t of i)if(c>=t.startAngle&&c<t.endAngle)return o.log(`Clicked slice index: ${t.index}`),t.index;return o.log("No slice found for the click event."),null}constructor(t,e,s,i){o.log("Creating Slice:",{startAngle:t,endAngle:e,index:s,segment:i}),this.startAngle=t,this.endAngle=e,this.index=s,this.segment=i}draw(t,e,s){o.log("Drawing slice:",{index:this.index,isSelected:s});const{backgroundColor:i="transparent",color:n="#000000",fontSize:a=16,borderColor:l="transparent",borderWidth:h=2,textOffset:c=.5,textAlign:r="center",textBaseline:p="middle",padding:d=0,text:g=""}=this.segment;t.beginPath(),t.moveTo(e/2,e/2),t.arc(e/2,e/2,e/2,this.startAngle,this.endAngle),t.closePath(),t.fillStyle=s?"yellow":i,t.fill(),h>0&&(t.lineWidth=h,t.strokeStyle=l,t.stroke());const m=this.startAngle+(this.endAngle-this.startAngle)/2,f=e/2.5-d,u=e/2+f*Math.cos(m)*c,w=e/2+f*Math.sin(m)*c;t.fillStyle=n,t.font=`${a}px Arial`,t.textAlign=r,t.textBaseline=p,t.fillText(g,u,w)}}class i{constructor(t,e){this.elem=t,this.options=e,this.size=Math.min(t.offsetWidth,t.offsetHeight);const s=document.createElement("canvas");s.width=s.height=this.size;const i=document.createElement("div");i.style.cssText=`width: ${this.size}px; height: ${this.size}px; overflow: hidden;position:relative`,i.appendChild(s),i.className="spin-it-up-container",this.context=s.getContext("2d"),t.parentElement.replaceChild(i,t),this.elem=this.canvas=s,this.elem.style.borderRadius="50%",this.setPin()}getCircleEdge(t){const e=this.canvas.getBoundingClientRect(),s=e.left+e.width/2,i=e.top+e.height/2;switch(t){case"left":return{x:e.left,y:i};case"right":return{x:e.right,y:i};case"top":return{x:s,y:e.top};case"bottom":return{x:s,y:e.bottom};case"center":return{x:s,y:i};default:throw new Error("Invalid position. Valid values are left, right, top, bottom, center.")}}setPin(){const{position:t="top"}=this.options.pin||{offsets:{}},e=document.querySelector(".wheel-section__pin");let s=this.getCircleEdge(t);e.style.top=`${s.y}px`,e.style.left=`${s.x}px`;let i=this.getCircleEdge("center");const n=document.querySelector(".wheel-section__center");n.style.top=`${i.y}px`,n.style.left=`${i.x}px`}async drawImage(t){const e=window.devicePixelRatio||1,s=this.size,i=this.size;this.canvas.width=s*e,this.canvas.height=i*e,this.canvas.style.width=`${s}px`,this.canvas.style.height=`${i}px`,this.context.scale(e,e),this.context.imageSmoothingEnabled=!0,this.context.imageSmoothingQuality="high";const n=s/i,o=t.width/t.height;let a=s,l=i,h=0,c=0;o>n?(l=i,a=l*o,h=(s-a)/2):(a=s,l=a/o,c=(i-l)/2),this.context.drawImage(t,h,c,a,l)}drawSlices(t,e=null){t.forEach((t=>t.draw(this.context,this.size,t.index===e)))}selectSlice(t,e){const s=this.size/2,i=this.size/2;this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.save(),this.context.translate(s,i),this.context.rotate(this.options.rotate*Math.PI/180),this.context.restore(),e(t)}addClickListener(t,e){}}const n={top:90,right:0,bottom:-90,left:180};class o{constructor(t,e={}){if(o.log("Initializing SpinItUp instance with element:",t,"and options:",e),!(t instanceof HTMLElement))throw new Error("Element is not a valid HTMLElement");this.elem=t,this.states={SPINNING:"spinning",STOPPED:"stopped",FINISHED:"finished",ERROR:"error"},this.options={spins:2,easing:"linear",callback:(t,e)=>o.log(t,e),segments:Array.from({length:6},((t,e)=>({segment:e+1}))),stopAt:null,direction:"clockwise",rotate:0,pin:{position:"top"},mode:"view",...e,type:this.elem instanceof HTMLImageElement?"image":"draw"},this.options.pin.offsets=e.pin.offsets||{"--pin-offset-x":"0%","--pin-offset-y":"25%"},this.directions=["clockwise","anti-clockwise"],this.key=`spin-it-up-${Math.random().toString(36).substring(7)}`,o.log("Generated unique key for instance:",this.key),this.pinOffset=null!=n[this.options.pin.position]?n[this.options.pin.position]:n.top,o.log(this.pinOffset),this.elem.style.overflow="hidden",this.options.rotate=0,this.state=this.states.STOPPED,(async()=>{await this.draw(),o.log("SpinItUp instance initialized.")})()}static log(){this.ENABLE_LOG=!1,this.ENABLE_LOG&&console.log("[SPIN-IT-UP]",...arguments)}getClassName(t){return`${this.key}-${t}`}async draw(){o.log("Drawing wheel in type:",this.options.type),"image"===this.options.type?await this.drawImageBackground():this.drawCanvas()}async drawImageBackground(){o.log("Drawing wheel using image background.");const t=new Image;t.src=this.elem.src,await new Promise(((e,s)=>{t.onload=e,t.onerror=s}));const e=new i(this.elem,this.options),n=s.create(this.options.segments),a=async s=>{await e.drawImage(t),e.drawSlices(n,s)};e.addClickListener(n,a),a(),this.canvas=e.canvas,o.log(this.canvas),"edit"==this.options.mode&&(this.selectSlice=t=>e.selectSlice(t,a),this.selectSlice(0))}drawCanvas(){o.log("Drawing wheel using canvas.");const t=new i(this.elem,this.options),e=s.create(this.options.segments),n=s=>t.drawSlices(e,s);t.addClickListener(e,n),n(),this.canvas=t.canvas,o.log(this.canvas),"edit"==this.options.mode&&(this.selectSlice=e=>t.selectSlice(e,n),this.selectSlice(0))}updateStopAngle(){const t=360/this.options.segments.length;this.stopAngle=this.minMax(this.options.stopAt*t-t+.25*t,this.options.stopAt*t-.25*t)+this.pinOffset,o.log("stopAngle",this.stopAngle)}minMax(t,e){return Math.floor(Math.random()*(e-t+1)+t)}style(){o.log("Generating CSS keyframe animation."),this.updateStopAngle();let t=360*this.options.spins;if(this.directions.includes(this.options.direction)||(this.options.direction="clockwise"),"random"===this.options.direction){const t=Math.floor(Math.random()*this.directions.length);this.options.direction=this.directions[t]}"clockwise"===this.options.direction?t+=360-this.stopAngle:"anti-clockwise"===this.options.direction&&(t=-(t+this.stopAngle)),this.options.speed=t/this.options.duration;const e=document.createElement("style");e.innerHTML=`@keyframes ${this.getClassName("animation-rotate")} { 100% { transform: rotate(${t}deg); } }`,document.head.appendChild(e)}async start(){if(!this.options.segments[this.options.stopAt-1])throw new Error(`stopAt must be a valid Number within the segments array 1 - ${this.options.segments.length}`);if(this.state!=this.states.STOPPED&&this.state!=this.states.FINISHED)return this.callback(this.state,{message:"Wheel is already spinning"});this.state=this.states.SPINNING,this.#t()}#t(){this.style(),this.callback(this.state),this.canvas.style.animation="none",setTimeout((()=>{this.canvas.style.animation=`${this.getClassName("animation-rotate")} ${this.options.duration}ms ${this.options.easing} 1 forwards`,this.timeout=setTimeout((()=>this.stop()),this.options.duration),this.options._mode=this.options.mode,this.options.mode=null}),0)}stop(){if(this.state!==this.states.SPINNING&&this.state!==this.states.FINISHED)return this.callback(this.state,{message:"Cannot stop; wheel is not spinning"});this.state=this.states.FINISHED,this.callback(this.state,{...this.getWinningSegment()}),clearTimeout(this.timeout),this.options.mode=this.options._mode}reset(){this.canvas.style.animation="none",this.stop()}getWinningSegment(){let t=this.options.stopAt-1;return{index:t,segment:this.options.segments[t]}}callback(t,e={}){"function"==typeof this.options.callback&&this.options.callback(t,{...e,timestamp:Date.now()})}}return e.default})()));